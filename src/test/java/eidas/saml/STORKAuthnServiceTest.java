package eidas.saml;

import static org.junit.Assert.assertEquals;

import java.util.Base64;

import org.apache.commons.io.Charsets;
import org.apache.commons.io.IOUtils;
import org.junit.Test;
import org.opensaml.util.resource.ClasspathResource;
import org.springframework.beans.factory.annotation.Autowired;

import eidas.AbstractIntegrationTest;
import eu.stork.mw.messages.saml.STORKResponse;


public class STORKAuthnServiceTest extends AbstractIntegrationTest {

    @Autowired
    private STORKAuthnService subject;

    private static String RESPONSE = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHNhbWwycDpSZXNwb25zZSB4bWxuczpzYW1sMnA9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpwcm90b2NvbCIgeG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiIHhtbG5zOnNhbWwyPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIiB4bWxuczpzdG9yaz0idXJuOmV1OnN0b3JrOm5hbWVzOnRjOlNUT1JLOjEuMDphc3NlcnRpb24iIHhtbG5zOnN0b3JrcD0idXJuOmV1OnN0b3JrOm5hbWVzOnRjOlNUT1JLOjEuMDpwcm90b2NvbCIgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiBDb25zZW50PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y29uc2VudDpvYnRhaW5lZCIgRGVzdGluYXRpb249Imh0dHBzOi8vdHN0LXBlcHMubWluZXoubmwvc3AtZGVtby9yZXNwb25zZS9zdG9yayIgSUQ9Il9kOGNmMWRhNmQ0YjI3NmQxNjk0N2MyOGJkNGQ0OTQzNSIgSW5SZXNwb25zZVRvPSJfMDEzNWY5YjZkYjRkMmMxNjNiNGVmOTM0N2IyM2MxMjUiIElzc3VlSW5zdGFudD0iMjAxNi0wOC0wOFQxMTo1ODowMy42NjlaIiBWZXJzaW9uPSIyLjAiPjxzYW1sMjpJc3N1ZXIgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDplbnRpdHkiPmh0dHBzOi8vdHN0LXBlcHMubWluZXoubmw8L3NhbWwyOklzc3Vlcj48ZHM6U2lnbmF0dXJlPjxkczpTaWduZWRJbmZvPjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZHNpZy1tb3JlI3JzYS1zaGEyNTYiLz48ZHM6UmVmZXJlbmNlIFVSST0iI19kOGNmMWRhNmQ0YjI3NmQxNjk0N2MyOGJkNGQ0OTQzNSI+PGRzOlRyYW5zZm9ybXM+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyI+PGVjOkluY2x1c2l2ZU5hbWVzcGFjZXMgeG1sbnM6ZWM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIgUHJlZml4TGlzdD0ieHMiLz48L2RzOlRyYW5zZm9ybT48L2RzOlRyYW5zZm9ybXM+PGRzOkRpZ2VzdE1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNzaGExIi8+PGRzOkRpZ2VzdFZhbHVlPjBtN1I5MituYzBPYkFBRjlKSmE3a21pM0dEYz08L2RzOkRpZ2VzdFZhbHVlPjwvZHM6UmVmZXJlbmNlPjwvZHM6U2lnbmVkSW5mbz48ZHM6U2lnbmF0dXJlVmFsdWU+VTkrdTF2d3ZRWHlBRlNYWHFBRHpTUzdZKzVOOG5nV1NuVzhadmtITXgvWU5lRGtFRXBqTjNNZjVDbEdPc1V4TkloMjhZcnFHeDBicmNDNEorSWVRRGhuWmNrRVIrUnVBWFhUWERYSmhwcUlYYWlvbXFQSE5DRUZ6SGdEYm5ycS9BWCtUTjhwZE9EWGZMNlk5MzVBV2tScXVzOHNDRkp6TlloblR2blRyaldUbktrbFNmOWRHL0JCOEIwQU5qTXpxMzFIMUtXUTNMbUdmTjBjdzZsNjQ3cjdvYitUa1pNWTNncWxNb0VPRWY5bEFpQkdGT0dkNThocHBSVWM0dGlJZ01Ga0ZOVFcrSStJMi9MQ285bVArSzBrdVRHNDBOV3J2MUpIclk5SVRWSHE2ZGsrL1dPQmVlTGtRU2pnNkZQcktGOXhkR0tQTUNJYnYrOFFzSzQrRnpBPT08L2RzOlNpZ25hdHVyZVZhbHVlPjxkczpLZXlJbmZvPjxkczpYNTA5RGF0YT48ZHM6WDUwOUNlcnRpZmljYXRlPk1JSUhnakNDQldxZ0F3SUJBZ0lVREc0OUZpQ0hReGxEamVRejk1ZjRJTmsvV1NRd0RRWUpLb1pJaHZjTkFRRUxCUUF3Z1lVeEN6QUoKQmdOVkJBWVRBazVNTVI0d0hBWURWUVFLREJWUmRXOVdZV1JwY3lCVWNuVnpkR3hwYm1zZ1FsWXhLREFtQmdOVkJBc01IMGx6YzNWcApibWNnUTJWeWRHbG1hV05oZEdsdmJpQkJkWFJvYjNKcGRIa3hMREFxQmdOVkJBTU1JMUYxYjFaaFpHbHpJRU5UVUNBdElGQkxTU0JQCmRtVnlhR1ZwWkNCRFFTQXRJRWN5TUI0WERURTBNRE15TmpFMU16RTBNRm9YRFRFM01ETXlOakUxTXpFek4xb3dnYTB4SFRBYkJnTlYKQkFVVEZEQXdNREF3TURBeE1EQXpNVFkyT1RRMk1EQXdNUXN3Q1FZRFZRUUdFd0pPVERFcE1DY0dBMVVFQ2hNZ2JXbHVhWE4wWlhKcApaU0IyWVc0Z1JXTnZibTl0YVhOamFHVWdXbUZyWlc0eEhqQWNCZ05WQkFzVEZVUnBaVzV6ZENCSlExUWdWV2wwZG05bGNtbHVaekUwCk1ESUdBMVVFQXhNclFVTkRMVTVNTFUxcGJrVmFMVkJGVUZNdFUwRk5UQzFEYkdsbGJuUXRVMmxuYmk1dGFXNWxlaTV1YkRDQ0FTSXcKRFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU9IWUZQV0g5T29MZHdJelU0eWM2UFpwTUkzby9SbFR3UHZGc243KwpVcnlMTkJIWTRaT3R1QjhHWGZNMzBxTnpZTkh0cllQdWRydHlPblpCRnFvbkd5U2piYzR0Tk80UVZVUXF4cGNzN3Y5U0JGWmVIQ1M2Cjk2QXMyekYvUlhqbEJTeHpTenBLNmE1ekd2OUZFeDZ2UmpQL3VIVStYRVNrMFhINVRsWklkS2libjVGSEVjWXVVRlI1ZWdibWJDY2kKUDd0Z0pncXdnWHFncUZNY1dUQ1FqSFpCMjViYzhjY2NiWDFsUjl5ellGcW5WMTV2d2hEZ0grMGNuRCt0eUVmTjZPRmZ5UjlKOThqaQoycGJKbWk4ZllkTlg4bUdlRWxlRFZYRnNnaTF2VGNZVHcvbktnMVVvcVlkbkNwclErNG1nYmpTSWxnd0p2SXZReHFLbVZmWW5RRXNDCkF3RUFBYU9DQXI0d2dnSzZNQXdHQTFVZEV3RUIvd1FDTUFBd2dnRXhCZ05WSFNBRWdnRW9NSUlCSkRDQ0FTQUdDbUNFRUFHSGF3RUMKQlFRd2dnRVFNSUhYQmdnckJnRUZCUWNDQWpDQnlocUJ4MUpsYkdsaGJtTmxJRzl1SUhSb2FYTWdZMlZ5ZEdsbWFXTmhkR1VnWW5rZwpZVzU1SUhCaGNuUjVJR0Z6YzNWdFpYTWdZV05qWlhCMFlXNWpaU0J2WmlCMGFHVWdjbVZzWlhaaGJuUWdVWFZ2Vm1Ga2FYTWdRMlZ5CmRHbG1hV05oZEdsdmJpQlFjbUZqZEdsalpTQlRkR0YwWlcxbGJuUWdZVzVrSUc5MGFHVnlJR1J2WTNWdFpXNTBjeUJwYmlCMGFHVWcKVVhWdlZtRmthWE1nY21Wd2IzTnBkRzl5ZVNBZ0tHaDBkSEE2THk5M2QzY3VjWFZ2ZG1Ga2FYTm5iRzlpWVd3dVkyOXRLUzR3TkFZSQpLd1lCQlFVSEFnRVdLR2gwZEhBNkx5OTNkM2N1Y1hWdmRtRmthWE5uYkc5aVlXd3VZMjl0TDNKbGNHOXphWFJ2Y25rd1NRWURWUjBSCkJFSXdRS0ErQmdvckJnRUVBWUkzRkFJRG9EQU1Makl1TVRZdU5USTRMakV1TVRBd015NHhMak11TlM0eUxqRXRNREF3TURBd01ERXcKTURNeE5qWTVORFl3TURBd2N3WUlLd1lCQlFVSEFRRUVaekJsTUNvR0NDc0dBUVVGQnpBQmhoNW9kSFJ3T2k4dmIyTnpjQzV4ZFc5MgpZV1JwYzJkc2IySmhiQzVqYjIwd053WUlLd1lCQlFVSE1BS0dLMmgwZEhBNkx5OTBjblZ6ZEM1eGRXOTJZV1JwYzJkc2IySmhiQzVqCmIyMHZjWFp2WTJGbk1pNWpjblF3RGdZRFZSMFBBUUgvQkFRREFnZUFNQ2tHQTFVZEpRUWlNQ0FHQ0NzR0FRVUZCd01DQmdnckJnRUYKQlFjREJBWUtLd1lCQkFHQ054UUNBakFmQmdOVkhTTUVHREFXZ0JScHkzOVFkZ0NHVTVWNUVzRllkaDhUNy9KTm96QTZCZ05WSFI4RQpNekF4TUMrZ0xhQXJoaWxvZEhSd09pOHZZM0pzTG5GMWIzWmhaR2x6WjJ4dlltRnNMbU52YlM5eGRtOWpZV2N5TG1OeWJEQWRCZ05WCkhRNEVGZ1FVMi9rWU04TTJ6dlRiTktvZS9KY2FNRFNnOHRzd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dJQkFGMUcxWVRldU9uK1ZGRkoKblFqTjFjb3VrMDFDZFppT3JKem9CSjBGRzdFM09QUGdrdnFmRXdDTTk0Y1hpT2JDNy9KK09idWs5WHBSY0Jod3c2U2RkdHhUY3RWYwpveFJlRlI2am5QYkhreTRTVlhMZkhuTEFjMHc3Z1Z6YjBXZVJ0Tkk4N0VMS2dtbm1ZbGdCajJRZ0g0Z3hZc3pVdkFLbVpMSFpseE5XCjl4ZFU5cTJlSysybEdodURRd09KdjRyRTRxN1ZDM2hyaFRFcVQvWHFGdXNFTlBXRjFRaVpRNXVON010RjdsckhzclhZTkFwc3hnV0oKZnAvVHhad2o0alNicWMrUFEwUGRvZTZreXJCaDdRUS9wUjZXZ1BCSTI1UFFsQkpncVoxK0V3eXJCREdrd0NPWS9FSnEwdVpGdExreQpKeStzMWdhdGY4TlVoNzFjYi8zQ0RlMkh3YUNyd3ZHZUR2WkRDaU5YNDhlc05ZSVZ2bUNvRGE2dnFweWh5Q0xRd2VtaDg0WlU4MDVxCk5CSzVZWkdvaC9JcU5OUTFYZTdIRTZEcldMc2JtL3NMdGprdWVrVGVaMXhzcmdVT2hVNDBwMW0raFdBVTBLeDZSZUpLSGVBTXg5V2oKWmtxSjRrckJEVXlqU2RkRUZGNU1jNkZibEluZERHL21FMU8rd2M1K2JNZkFEY0oyY09jT21NMDZJSzdZdWFxZms5MWxMTFlBOTJKLwpIU1dYNWRjZ2RyeHBoMTNqQThNMUltWW5yN3BDTG5UUEUyRVNoRW9rS0NROEVBZjdmRmhYZFpIV0FMc0ZwY0svWGpLdXA5eWJ2dWF4Ci9JblVaejg5WTZXN0tpU2FxYUo4UzFZN2pBSzV5RmtSRXpLcTVzS0wwRDdIbFc2YmNrMFIyVWNXZkJ5ZjwvZHM6WDUwOUNlcnRpZmljYXRlPjwvZHM6WDUwOURhdGE+PC9kczpLZXlJbmZvPjwvZHM6U2lnbmF0dXJlPjxzYW1sMnA6U3RhdHVzPjxzYW1sMnA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+PHNhbWwycDpTdGF0dXNNZXNzYWdlPnVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpzdGF0dXM6U3VjY2Vzczwvc2FtbDJwOlN0YXR1c01lc3NhZ2U+PC9zYW1sMnA6U3RhdHVzPjxzYW1sMjpBc3NlcnRpb24gSUQ9Il9hMGNiODQ0NzkwYzAzYzM3ZDE0Yjg5YTI2Yzg4ZTQ2NiIgSXNzdWVJbnN0YW50PSIyMDE2LTA4LTA4VDExOjU4OjAzLjY2OVoiIFZlcnNpb249IjIuMCI+PHNhbWwyOklzc3VlciBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OmVudGl0eSI+aHR0cHM6Ly90c3QtcGVwcy5taW5lei5ubDwvc2FtbDI6SXNzdWVyPjxkczpTaWduYXR1cmU+PGRzOlNpZ25lZEluZm8+PGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxkc2lnLW1vcmUjcnNhLXNoYTI1NiIvPjxkczpSZWZlcmVuY2UgVVJJPSIjX2EwY2I4NDQ3OTBjMDNjMzdkMTRiODlhMjZjODhlNDY2Ij48ZHM6VHJhbnNmb3Jtcz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIj48ZWM6SW5jbHVzaXZlTmFtZXNwYWNlcyB4bWxuczplYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIiBQcmVmaXhMaXN0PSJ4cyIvPjwvZHM6VHJhbnNmb3JtPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiLz48ZHM6RGlnZXN0VmFsdWU+OTIzc3pxQnVhaVlEU2pMYWUwMUtjU082M2VZPTwvZHM6RGlnZXN0VmFsdWU+PC9kczpSZWZlcmVuY2U+PC9kczpTaWduZWRJbmZvPjxkczpTaWduYXR1cmVWYWx1ZT4zc1hYMTdLWnpkMmttVUZiQkZwdmcyVnNPdFlHWkZLOHZ1K2p2VktkMklJYnpoNHhRQ09paFBhWlBxNnA5TW5iY2lKUHI1cmhLVFAwUWJpc3R5SFBnYlpYZjBYeHJpTExLNjk5VWUzb1QvcHhYMEN5aytTRlpld0J6V09LZ0Roa1g0OUZ4TGF3d0FZSG9aRldXZEtkNGg0a016cDQ4NnNjVkpWbVZselBoYStESUx6OW8reDU1WXdTWTFDMEZ2ZlVkdEtrcXByNHN3ZXA0WUhSV29sZ2xRbFo3dEsrSE4yTTREa1p5bHdHcUFnVThScDhXbDZaY2Mzd2RlOG4zY3ZYb0c3cUZpS0hhcXhZcGRoNDZiSk1ua1FPaDBwbTRWVnZIUlRMck0yU0pHY20wNXdXZlZVNmhYWFhqSU1oK2FXdjBzV2xkckQwNU9Hc0VlYk1PVFpCTmc9PTwvZHM6U2lnbmF0dXJlVmFsdWU+PGRzOktleUluZm8+PGRzOlg1MDlEYXRhPjxkczpYNTA5Q2VydGlmaWNhdGU+TUlJSGdqQ0NCV3FnQXdJQkFnSVVERzQ5RmlDSFF4bERqZVF6OTVmNElOay9XU1F3RFFZSktvWklodmNOQVFFTEJRQXdnWVV4Q3pBSgpCZ05WQkFZVEFrNU1NUjR3SEFZRFZRUUtEQlZSZFc5V1lXUnBjeUJVY25WemRHeHBibXNnUWxZeEtEQW1CZ05WQkFzTUgwbHpjM1ZwCmJtY2dRMlZ5ZEdsbWFXTmhkR2x2YmlCQmRYUm9iM0pwZEhreExEQXFCZ05WQkFNTUkxRjFiMVpoWkdseklFTlRVQ0F0SUZCTFNTQlAKZG1WeWFHVnBaQ0JEUVNBdElFY3lNQjRYRFRFME1ETXlOakUxTXpFME1Gb1hEVEUzTURNeU5qRTFNekV6TjFvd2dhMHhIVEFiQmdOVgpCQVVURkRBd01EQXdNREF4TURBek1UWTJPVFEyTURBd01Rc3dDUVlEVlFRR0V3Sk9UREVwTUNjR0ExVUVDaE1nYldsdWFYTjBaWEpwClpTQjJZVzRnUldOdmJtOXRhWE5qYUdVZ1dtRnJaVzR4SGpBY0JnTlZCQXNURlVScFpXNXpkQ0JKUTFRZ1ZXbDBkbTlsY21sdVp6RTAKTURJR0ExVUVBeE1yUVVORExVNU1MVTFwYmtWYUxWQkZVRk10VTBGTlRDMURiR2xsYm5RdFUybG5iaTV0YVc1bGVpNXViRENDQVNJdwpEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBT0hZRlBXSDlPb0xkd0l6VTR5YzZQWnBNSTNvL1JsVHdQdkZzbjcrClVyeUxOQkhZNFpPdHVCOEdYZk0zMHFOellOSHRyWVB1ZHJ0eU9uWkJGcW9uR3lTamJjNHROTzRRVlVRcXhwY3M3djlTQkZaZUhDUzYKOTZBczJ6Ri9SWGpsQlN4elN6cEs2YTV6R3Y5RkV4NnZSalAvdUhVK1hFU2swWEg1VGxaSWRLaWJuNUZIRWNZdVVGUjVlZ2JtYkNjaQpQN3RnSmdxd2dYcWdxRk1jV1RDUWpIWkIyNWJjOGNjY2JYMWxSOXl6WUZxblYxNXZ3aERnSCswY25EK3R5RWZONk9GZnlSOUo5OGppCjJwYkptaThmWWROWDhtR2VFbGVEVlhGc2dpMXZUY1lUdy9uS2cxVW9xWWRuQ3ByUSs0bWdialNJbGd3SnZJdlF4cUttVmZZblFFc0MKQXdFQUFhT0NBcjR3Z2dLNk1Bd0dBMVVkRXdFQi93UUNNQUF3Z2dFeEJnTlZIU0FFZ2dFb01JSUJKRENDQVNBR0NtQ0VFQUdIYXdFQwpCUVF3Z2dFUU1JSFhCZ2dyQmdFRkJRY0NBakNCeWhxQngxSmxiR2xoYm1ObElHOXVJSFJvYVhNZ1kyVnlkR2xtYVdOaGRHVWdZbmtnCllXNTVJSEJoY25SNUlHRnpjM1Z0WlhNZ1lXTmpaWEIwWVc1alpTQnZaaUIwYUdVZ2NtVnNaWFpoYm5RZ1VYVnZWbUZrYVhNZ1EyVnkKZEdsbWFXTmhkR2x2YmlCUWNtRmpkR2xqWlNCVGRHRjBaVzFsYm5RZ1lXNWtJRzkwYUdWeUlHUnZZM1Z0Wlc1MGN5QnBiaUIwYUdVZwpVWFZ2Vm1Ga2FYTWdjbVZ3YjNOcGRHOXllU0FnS0doMGRIQTZMeTkzZDNjdWNYVnZkbUZrYVhObmJHOWlZV3d1WTI5dEtTNHdOQVlJCkt3WUJCUVVIQWdFV0tHaDBkSEE2THk5M2QzY3VjWFZ2ZG1Ga2FYTm5iRzlpWVd3dVkyOXRMM0psY0c5emFYUnZjbmt3U1FZRFZSMFIKQkVJd1FLQStCZ29yQmdFRUFZSTNGQUlEb0RBTUxqSXVNVFl1TlRJNExqRXVNVEF3TXk0eExqTXVOUzR5TGpFdE1EQXdNREF3TURFdwpNRE14TmpZNU5EWXdNREF3Y3dZSUt3WUJCUVVIQVFFRVp6QmxNQ29HQ0NzR0FRVUZCekFCaGg1b2RIUndPaTh2YjJOemNDNXhkVzkyCllXUnBjMmRzYjJKaGJDNWpiMjB3TndZSUt3WUJCUVVITUFLR0syaDBkSEE2THk5MGNuVnpkQzV4ZFc5MllXUnBjMmRzYjJKaGJDNWoKYjIwdmNYWnZZMkZuTWk1amNuUXdEZ1lEVlIwUEFRSC9CQVFEQWdlQU1Da0dBMVVkSlFRaU1DQUdDQ3NHQVFVRkJ3TUNCZ2dyQmdFRgpCUWNEQkFZS0t3WUJCQUdDTnhRQ0FqQWZCZ05WSFNNRUdEQVdnQlJweTM5UWRnQ0dVNVY1RXNGWWRoOFQ3L0pOb3pBNkJnTlZIUjhFCk16QXhNQytnTGFBcmhpbG9kSFJ3T2k4dlkzSnNMbkYxYjNaaFpHbHpaMnh2WW1Gc0xtTnZiUzl4ZG05allXY3lMbU55YkRBZEJnTlYKSFE0RUZnUVUyL2tZTThNMnp2VGJOS29lL0pjYU1EU2c4dHN3RFFZSktvWklodmNOQVFFTEJRQURnZ0lCQUYxRzFZVGV1T24rVkZGSgpuUWpOMWNvdWswMUNkWmlPckp6b0JKMEZHN0UzT1BQZ2t2cWZFd0NNOTRjWGlPYkM3L0orT2J1azlYcFJjQmh3dzZTZGR0eFRjdFZjCm94UmVGUjZqblBiSGt5NFNWWExmSG5MQWMwdzdnVnpiMFdlUnROSTg3RUxLZ21ubVlsZ0JqMlFnSDRneFlzelV2QUttWkxIWmx4TlcKOXhkVTlxMmVLKzJsR2h1RFF3T0p2NHJFNHE3VkMzaHJoVEVxVC9YcUZ1c0VOUFdGMVFpWlE1dU43TXRGN2xySHNyWFlOQXBzeGdXSgpmcC9UeFp3ajRqU2JxYytQUTBQZG9lNmt5ckJoN1FRL3BSNldnUEJJMjVQUWxCSmdxWjErRXd5ckJER2t3Q09ZL0VKcTB1WkZ0TGt5Ckp5K3MxZ2F0ZjhOVWg3MWNiLzNDRGUySHdhQ3J3dkdlRHZaRENpTlg0OGVzTllJVnZtQ29EYTZ2cXB5aHlDTFF3ZW1oODRaVTgwNXEKTkJLNVlaR29oL0lxTk5RMVhlN0hFNkRyV0xzYm0vc0x0amt1ZWtUZVoxeHNyZ1VPaFU0MHAxbStoV0FVMEt4NlJlSktIZUFNeDlXagpaa3FKNGtyQkRVeWpTZGRFRkY1TWM2RmJsSW5kREcvbUUxTyt3YzUrYk1mQURjSjJjT2NPbU0wNklLN1l1YXFmazkxbExMWUE5MkovCkhTV1g1ZGNnZHJ4cGgxM2pBOE0xSW1ZbnI3cENMblRQRTJFU2hFb2tLQ1E4RUFmN2ZGaFhkWkhXQUxzRnBjSy9Yakt1cDl5YnZ1YXgKL0luVVp6ODlZNlc3S2lTYXFhSjhTMVk3akFLNXlGa1JFektxNXNLTDBEN0hsVzZiY2swUjJVY1dmQnlmPC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PC9kczpTaWduYXR1cmU+PHNhbWwyOlN1YmplY3Q+PHNhbWwyOk5hbWVJRCBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OnRyYW5zaWVudCIgTmFtZVF1YWxpZmllcj0iaHR0cHM6Ly90c3QtcGVwcy5taW5lei5ubCI+dXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6dHJhbnNpZW50PC9zYW1sMjpOYW1lSUQ+PHNhbWwyOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj48c2FtbDI6U3ViamVjdENvbmZpcm1hdGlvbkRhdGEgQWRkcmVzcz0iMTkyLjg3LjE2MS4yMDYlMjEwIiBJblJlc3BvbnNlVG89Il8wMTM1ZjliNmRiNGQyYzE2M2I0ZWY5MzQ3YjIzYzEyNSIgTm90T25PckFmdGVyPSIyMDE2LTA4LTA4VDEyOjAzOjAzLjY2OVoiIFJlY2lwaWVudD0iaHR0cHM6Ly90c3QtcGVwcy5taW5lei5ubC9zcC1kZW1vL3Jlc3BvbnNlL3N0b3JrIi8+PC9zYW1sMjpTdWJqZWN0Q29uZmlybWF0aW9uPjwvc2FtbDI6U3ViamVjdD48c2FtbDI6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMTYtMDgtMDhUMTE6NTg6MDMuNjY5WiIgTm90T25PckFmdGVyPSIyMDE2LTA4LTA4VDEyOjAzOjAzLjY2OVoiPjxzYW1sMjpBdWRpZW5jZVJlc3RyaWN0aW9uPjxzYW1sMjpBdWRpZW5jZT5odHRwczovL3RzdC1wZXBzLm1pbmV6Lm5sL3NwLWRlbW8vbWV0YWRhdGE8L3NhbWwyOkF1ZGllbmNlPjwvc2FtbDI6QXVkaWVuY2VSZXN0cmljdGlvbj48c2FtbDI6T25lVGltZVVzZS8+PC9zYW1sMjpDb25kaXRpb25zPjxzYW1sMjpBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMTYtMDgtMDhUMTE6NTg6MDMuNjY5WiI+PHNhbWwyOlN1YmplY3RMb2NhbGl0eSBBZGRyZXNzPSIxOTIuODcuMTYxLjIwNiUyMTAiLz48c2FtbDI6QXV0aG5Db250ZXh0PjxzYW1sMjpBdXRobkNvbnRleHREZWNsLz48L3NhbWwyOkF1dGhuQ29udGV4dD48L3NhbWwyOkF1dGhuU3RhdGVtZW50PjxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJodHRwOi8vd3d3LnN0b3JrLmdvdi5ldS8xLjAvZ2l2ZW5OYW1lIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSIgc3Rvcms6QXR0cmlidXRlU3RhdHVzPSJBdmFpbGFibGUiPjxzYW1sMjpBdHRyaWJ1dGVWYWx1ZSB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4c2k6dHlwZT0ieHM6YW55VHlwZSI+VXNlcjwvc2FtbDI6QXR0cmlidXRlVmFsdWU+PC9zYW1sMjpBdHRyaWJ1dGU+PHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJodHRwOi8vd3d3LnN0b3JrLmdvdi5ldS8xLjAvZUlkZW50aWZpZXIiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIiBzdG9yazpBdHRyaWJ1dGVTdGF0dXM9IkF2YWlsYWJsZSI+PHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4czphbnlUeXBlIj5CRS9OTC8xMjM0NTwvc2FtbDI6QXR0cmlidXRlVmFsdWU+PC9zYW1sMjpBdHRyaWJ1dGU+PC9zYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PC9zYW1sMjpBc3NlcnRpb24+PC9zYW1sMnA6UmVzcG9uc2U+";

    @Test
    public void build_stork_response() throws Exception {
        STORKResponse response = subject.buildSTORKResponse(new String(Base64.getDecoder().decode(RESPONSE), Charsets.UTF_8));
        assertEquals("_d8cf1da6d4b276d16947c28bd4d49435", response.getID());
    }
}
